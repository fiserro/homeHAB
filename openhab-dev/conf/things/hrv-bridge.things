// HRV Bridge MQTT Thing configuration
// Publishes HRV output values to the Python DAC Bridge via MQTT
//
// Output topics (OpenHAB â†’ Bridge):
//   - homehab/hrv/value/power    -> Base power value
//   - homehab/hrv/value/intake   -> Intake power value
//   - homehab/hrv/value/exhaust  -> Exhaust power value
//   - homehab/hrv/value/test     -> Test power value (for calibration)
//
// GPIO configuration (bidirectional, retained):
//   - homehab/hrv/source/gpio18  -> Source: "power"|"intake"|"exhaust"|"test"|"off"
//   - homehab/hrv/source/gpio19  -> Source: "power"|"intake"|"exhaust"|"test"|"off"
//
// Calibration tables (bidirectional, retained):
//   - homehab/hrv/calibration/gpio18 -> JSON calibration table
//   - homehab/hrv/calibration/gpio19 -> JSON calibration table

Thing mqtt:topic:mosquitto:hrv_bridge "HRV Bridge" (mqtt:broker:mosquitto) {
    Channels:
        // ========== Output Values ==========
        // These are the source values that GPIOs can be configured to use

        // Base power output
        Type dimmer : power "HRV Power" [
            commandTopic="homehab/hrv/value/power",
            min=0,
            max=100
        ]
        // Intake motor power
        Type dimmer : intake "HRV Intake Power" [
            commandTopic="homehab/hrv/value/intake",
            min=0,
            max=100
        ]
        // Exhaust motor power
        Type dimmer : exhaust "HRV Exhaust Power" [
            commandTopic="homehab/hrv/value/exhaust",
            min=0,
            max=100
        ]
        // Test power (for calibration)
        Type dimmer : test "HRV Test Power" [
            commandTopic="homehab/hrv/value/test",
            min=0,
            max=100
        ]

        // ========== GPIO Configuration ==========
        // Use source="off" to disable a GPIO

        // GPIO 18 source selection
        Type string : gpio18Source "GPIO18 Source" [
            commandTopic="homehab/hrv/source/gpio18",
            stateTopic="homehab/hrv/source/gpio18",
            retained=true
        ]
        // GPIO 19 source selection
        Type string : gpio19Source "GPIO19 Source" [
            commandTopic="homehab/hrv/source/gpio19",
            stateTopic="homehab/hrv/source/gpio19",
            retained=true
        ]

        // ========== Calibration Tables ==========

        // Calibration table for GPIO 18 (JSON format, retained)
        Type string : calibrationGpio18 "Calibration GPIO18" [
            commandTopic="homehab/hrv/calibration/gpio18",
            stateTopic="homehab/hrv/calibration/gpio18",
            retained=true
        ]
        // Calibration table for GPIO 19 (JSON format, retained)
        Type string : calibrationGpio19 "Calibration GPIO19" [
            commandTopic="homehab/hrv/calibration/gpio19",
            stateTopic="homehab/hrv/calibration/gpio19",
            retained=true
        ]
}
