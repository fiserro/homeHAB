// HRV Bridge MQTT Thing configuration
// Publishes final PWM values to the Python DAC Bridge via MQTT
//
// Output topics (OpenHAB â†’ Bridge):
//   - homehab/hrv/pwm/gpio18  -> Final PWM value for GPIO 18 (0-100)
//   - homehab/hrv/pwm/gpio19  -> Final PWM value for GPIO 19 (0-100)
//
// The Python bridge only receives PWM values and sets them on GPIO pins.
// All calculation (source selection, calibration) is done in OpenHAB/HrvCalculator.

Thing mqtt:topic:mosquitto:hrv_bridge "HRV Bridge" (mqtt:broker:mosquitto) {
    Channels:
        // Final PWM output for GPIO 18
        Type dimmer : pwmGpio18 "HRV PWM GPIO18" [
            commandTopic="homehab/hrv/pwm/gpio18",
            min=0,
            max=100
        ]
        // Final PWM output for GPIO 19
        Type dimmer : pwmGpio19 "HRV PWM GPIO19" [
            commandTopic="homehab/hrv/pwm/gpio19",
            min=0,
            max=100
        ]
        // GPIO 17 digital output (used for bypass valve)
        // OFF = 0 (low), ON = 1 (high)
        Type switch : gpio17 "HRV GPIO17" [
            commandTopic="homehab/hrv/gpio17"
        ]
        // 1-Wire temperature sensors (DS18B20) on GPIO27
        // Channel name = gpio27_<sensor_id>, topic = homehab/hrv/w1/<sensor_id>
        Type number : gpio27_28-0316840d44ff "W1 GPIO27 28-0316840d44ff" [
            stateTopic="homehab/hrv/w1/28-0316840d44ff"
        ]
        // SCT013 current sensors via Waveshare ADC (ADS1256)
        // Channel name = current_ad<n>, topic = homehab/hrv/current/ad<n>
        Type number : current_ad0 "Current AD0" [
            stateTopic="homehab/hrv/current/ad0"
        ]
        Type number : current_ad1 "Current AD1" [
            stateTopic="homehab/hrv/current/ad1"
        ]
        // MH-Z19C CO2 sensor via UART
        // Channel name = co2, topic = homehab/hrv/co2
        Type number : co2 "CO2" [
            stateTopic="homehab/hrv/co2"
        ]
        Type number : co2_temp "CO2 Temperature" [
            stateTopic="homehab/hrv/co2_temp"
        ]
}
